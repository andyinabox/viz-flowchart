!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){var t=function(t,e){return e(t)+e.bandwidth()/2},e=function(t,e){var n,r;for(n=0;n<e.length;n++)if(e[n].id===t){r=n;break}return r},n=function(n,r,i){var o=e(n,r);return t(o,i)},r=function(t,e){t.classed("hidden-step",function(t,n){return n>e})},i=function(t,e){t.classed("action-button",function(t,n){return t.action&&n===e+1}).classed("hidden-step",function(t,n){return n>e+1})},o=function(t){t.on("click",function(t){select(this).classed("action-button")&&t.action(t)})},a=function(t){var e={},n=Array.prototype.slice.call(t);return e.actors=n.filter(function(t){return"viz-actor"===t.tagName.toLowerCase()}).map(function(t){return{id:t.id,title:t.innerHTML.trim()}}),e.steps=n.filter(function(t){return"viz-step"===t.tagName.toLowerCase()}).map(function(t){return{from:t.getAttribute("from"),to:t.getAttribute("to"),desc:t.innerHTML.trim()}}),e},s=window.d3,c=s.scaleBand,l=s.scaleOrdinal,p=s.range,u=s.create,d=s.path,f=s.schemeDark2,h={width:800,circleRadius:15,marginTop:0,marginBottom:0,marginLeft:10,marginRight:10,stepHeight:120,flowArrowSize:10,stepDescArrowSize:13},m="\n<style>\nsvg {\n  width: 100%;\n  stroke-width: 1px;\n  font-family: var(--main-font-family, 'Open Sans', Helvetica, Arial, sans-serif);\n}\n\n.actor-box {\n  /* fill: #ddd; */\n  opacity: 0.5;\n  /* stroke: black; */\n}\n\n.actor-line {\n  stroke: #ddd;\n  stroke-width: 1px;\n}\n\n.actor-text {\n  fill: black;\n  text-align: center;\n  font-size: 0.75rem;\n  height: 0.75rem;\n}\n\n.hidden-step {\n  transition: fill 200ms, stroke 200ms, opacity 200ms;\n}\n\n.step-line {\n  /* stroke: black; */\n  fill: none;\n  stroke-width: 2px;\n}\n\n.step-line.hidden-step {\n  stroke: #ccc\n}\n\n/* .step-circle { */\n  /* stroke: black; */\n  /* opacity: 0.5; */\n/* } */\n\n.step-circle.hidden-step {\n  fill: white;\n  stroke: #ccc;\n}\n\n.step-number {\n  font-family: 'Open Sans', Helvetica, Arial, sans-serif;\n  fill: white;\n  line-height: 30px;\n}\n\n.step-number.hidden-step {\n  fill: #ccc;\n}\n\n.step-desc {\n  fill: black;\n}\n\n.step-desc.hidden-step {\n  fill: #ccc;\n}\n\n.step-desc.action-button {\n  fill: white;\n  font-weight: bold;\n  cursor: pointer;\n}\n\n.step-desc-bg {\n  /* fill: white; */\n  opacity: 0.5;\n}\n\n.step-desc-bg.hidden-step {\n  opacity: 0;\n  /* fill: none; */\n}\n\n.step-desc-bg.action-button {\n  opacity: 1;\n  fill: black;\n  cursor: pointer;\n}\n</style>\n<div class=\"viz-container\"></div>\n",g=function(s){function g(){s.call(this),this.attachShadow({mode:"open"});var t=a(this.children),e=t.actors,n=t.steps;this.shadowRoot.innerHTML=m;var r=this.shadowRoot.querySelector(".viz-container");Object.assign(this,{el:r,actors:e,steps:n}),this.options=Object.assign({},h),this.setup()}s&&(g.__proto__=s),(g.prototype=Object.create(s&&s.prototype)).constructor=g;var b={observedAttributes:{configurable:!0}};return b.observedAttributes.get=function(){return["step"]},g.prototype.attributeChangedCallback=function(){this.update()},g.prototype.setup=function(){var t=this.el,e=this.steps,n=this.actors,r=this.options,i=r.stepHeight,o=r.marginTop,a=r.width,s=.66*i,d=e.length*i+2*s+o+r.marginBottom;Object.assign(this.options,{actorHeight:s,stepDescFontSize:i/7,height:d});var h=t.getAttribute("step")||e.length-1;this.currentStep=parseInt(h),this.actorsScale=c().domain(p(n.length)).range([0,a]).padding(.25),this.stepsScale=c().domain(p(e.length)).range([1.5*i+o,d]),this.colorScale=l(f);var m=u("svg");m.attr("width",a).attr("height",d).attr("viewBox","0 0 "+a+" "+d),t.appendChild(m.node()),this.svg=m,this.createActors(),this.updateSteps()},g.prototype.createActors=function(){var e=this.options,n=e.actorHeight,r=e.height,i=e.marginBottom,o=this.actors,a=this.actorsScale,s=this.colorScale,c=e.marginTop,l=this.svg.append("g").attr("class","actors");l.append("g").attr("class","actor-boxes").selectAll(".actor-box").data(o).enter().append("rect").attr("class","actor-box").attr("height",n).attr("width",a.bandwidth()).attr("fill",function(t,e){return s(e)}).attr("x",function(t,e){return a(e)}).attr("y",c),l.append("g").attr("class","actor-texts").selectAll(".actor-text").data(o).enter().append("text").attr("class","actor-text").attr("x",function(e,n){return t(n,a)}).attr("y",c+n/2).attr("dominant-baseline","middle").attr("text-anchor","middle").text(function(t){return t.title}),l.append("g").attr("class","actor-lines").selectAll(".actor-line").data(o).enter().append("line").attr("class","actor-line").attr("x1",function(e,n){return t(n,a)}).attr("x2",function(e,n){return t(n,a)}).attr("y1",c+n).attr("y2",r-i-n).text(function(t){return t.title}),l.append("g").attr("class","actor-boxes").selectAll(".actor-box").data(o).enter().append("rect").attr("class","actor-box").attr("height",n).attr("width",a.bandwidth()).attr("fill",function(t,e){return s(e)}).attr("x",function(t,e){return a(e)}).attr("y",r-i-n),l.append("g").attr("class","actor-texts").selectAll(".actor-text").data(o).enter().append("text").attr("class","actor-text").attr("x",function(e,n){return t(n,a)}).attr("y",r-i-n/2).attr("dominant-baseline","middle").attr("text-anchor","middle").text(function(t){return t.title})},g.prototype.updateSteps=function(){var t=this,a=this.svg,s=this.actors,c=this.steps,l=this.actorsScale,p=this.stepsScale,u=this.currentStep,f=this.colorScale,h=this.options,m=h.flowArrowSize,g=h.circleRadius,b=h.stepDescFontSize,v=a.append("g").attr("class","steps"),x=function(t){return n(t.from,s,l)},y=function(t){return n(t.to,s,l)},w=function(t,e){return p(e)},S=function(t){return t.to===t.from},A=function(t,n){var r=d(),i=e(t.from,s),o=e(t.to,s);return i===o?r.arc(x(t),p(n),p.bandwidth(),Math.PI/2,3*Math.PI/2):(r.moveTo(x(t),p(n)),r.lineTo(y(t),p(n))),i<o?(r.moveTo(y(t)-m,p(n)-m/2),r.lineTo(y(t),p(n)),r.lineTo(y(t)-m,p(n)+m/2)):o<i&&(r.moveTo(y(t)+m,p(n)-m/2),r.lineTo(y(t),p(n)),r.lineTo(y(t)+m,p(n)+m/2)),r.toString()};v.append("g").attr("class","step-lines").selectAll(".step-line").data(c).join(function(t){return t.append("path").attr("class","step-line").classed("step-line-loop",function(t){return S(t)}).classed("step-line-normal",function(t){return!S(t)}).call(r,u).attr("stroke",function(t){return f(e(t.from,s))}).attr("d",A)},function(t){return t.call(r,u)},function(t){return t.remove()}),v.append("g").attr("class","step-circles").selectAll(".step-circle").data(c).join(function(t){return t.append("circle").attr("class","step-circle").call(r,u).attr("fill",function(t){return f(e(t.from,s))}).attr("r",g).attr("cx",x).attr("cy",w)},function(t){return t.call(r,u)},function(t){return t.remove()}),v.append("g").attr("class","step-numbers").selectAll(".step-number").data(c).join(function(t){return t.append("text").attr("class","step-number").call(r,u).style("font-size",1.2*g+"px").attr("x",x).attr("y",function(t,e){return p(e)+2}).text(function(t,e){return e+1}).attr("dominant-baseline","middle").attr("text-anchor","middle")},function(t){return t.call(r,u)},function(t){return t.remove()}),v.append("g").attr("class","step-desc-bgs").selectAll(".step-desc-bg").data(c).join(function(n){return n.append("path").attr("class","step-desc-bg").call(i,u).call(t.drawStepDescriptionBox.bind(t)).attr("fill",function(t){return f(e(t.from,s))})},function(t){return t.call(i,u)},function(t){return t.remove()}),v.append("g").attr("class","step-descs").selectAll(".step-desc").data(c).join(function(t){return t.append("text").attr("class","step-desc").style("font-size",b+"px").call(i,u).call(o).attr("x",a.attr("width")/2).attr("y",function(t,e){return p(e)-p.bandwidth()/2}).text(function(t){return t.desc}).attr("dominant-baseline","middle").attr("text-anchor","middle")},function(t){return t.call(i,u).call(o)},function(t){return t.remove()})},g.prototype.drawStepDescriptionBox=function(t){var e=this.actors,r=this.actorsScale,i=this.stepsScale,o=this.options,a=o.stepDescArrowSize,s=o.stepDescFontSize,c=o.marginRight,l=o.marginLeft,p=o.width;t.attr("d",function(t,o){var u=d(),f=i(o)-i.bandwidth()/2-s,h=f+2*s,m=n(t.from,e,r);return u.moveTo(l,f),u.lineTo(p-c,f),u.lineTo(p-c,h),u.lineTo(m+a/2,h),u.lineTo(m,h+a),u.lineTo(m-a/2,h),u.lineTo(l,h),u.closePath(),u.toString()})},g.prototype.update=function(){this.updateSteps()},Object.defineProperties(g,b),g}(HTMLElement),b=function(t){function e(){t.call(this)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={observedAttributes:{configurable:!0}};return n.observedAttributes.get=function(){return["from","to"]},Object.defineProperties(e,n),e}(HTMLElement),v=function(t){function e(){t.call(this)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={observedAttributes:{configurable:!0}};return n.observedAttributes.get=function(){return["id","title"]},Object.defineProperties(e,n),e}(HTMLElement);customElements.define("viz-actor",b),customElements.define("viz-step",v),customElements.define("viz-flowchart",g)});
//# sourceMappingURL=viz-flowchart.umd.js.map
